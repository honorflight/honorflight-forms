<div cg-busy="serviceHistory.promises">
  <div class="row">
    <div class="col-xs-12 col-sm-12">
      <div class="page-header">
        <h1>Service History</h1>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-6 col-sm-6">
      <div class="form-group">
        <label class="control-label">Start Year</label>
        <input type="number" ng-model="contact.person.serviceHistory.startYear" class="form-control">
      </div>
      <!-- (Array) contact.person.serviceHistory.service_awards_attributes
      t.integer :quantity
      t.text :comment
      t.references :service_history, index: true
      t.references :award, index: true

      [{"quantity":2, "comment":"some arbitrary comment", ..., "award_id":2}, ... ]
      PUT http://honorflight.dev/api/service_histories/3
      {"id":3,
 "start_year":null,
 "end_year":null,
 "activity":null,
 "story":null,
 "branch_id":1,
 "rank_id":null,
 "rank_type_id":null,
 "person_id":6,
 "service_awards_attributes": [
   {"quantity":2, "comment":"some arbitrary comment", "award_id":1}
 ]
}
    -->
    </div>
    <div class="col-xs-6 col-sm-6">
      <div>
        <label class="control-label">End Year</label>
        <input type="number" ng-model="contact.person.serviceHistory.endYear" class="form-control">
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 col-sm-12">
      <div class="form-group">
        <label class="control-label">Activity</label>
        <input type="text" ng-model="contact.person.serviceHistory.activity"
        class="form-control"
        ng-trim="true">
      </div>
    </div>
  </div>



  <div class="row">
    <div class="col-xs-12 col-sm-12">
      <div class="form-group">
        <label class="control-label">Your Story</label>
        <textarea class="form-control" placeholder="Tell us more about your time in the service(s)" ng-model="contact.person.serviceHistory.story"
        ng-trim="true" rows="3">
        </textarea>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-4 col-sm-4">
      <div class="form-group">
        <label class="control-label">Branch</label>
        <select class="form-control"
        ng-model="contact.person.serviceHistory.branchId"
        required
        ng-options="branch.id as branch.name for branch in serviceHistory.branches">
          <option value="">Select One</option>
        </select>
      </div>
    </div>
    <div class="col-xs-4 col-sm-4">
      <div class="form-group">
        <label class="control-label">Rank Type</label>
        <select class="form-control"
        ng-model="contact.person.serviceHistory.rankTypeId"
        required
        ng-options="type.id as type.name for type in serviceHistory.rankTypes">
          <option value="">Select One</option>
        </select>
      </div>
    </div>
    <div class="col-xs-4 col-sm-4">
      <div class="form-group">
        <label class="control-label">Rank</label>
        <select class="form-control"
        ng-model="contact.person.serviceHistory.rankId"
        ng-options="rank.id as rank.name for rank in serviceHistory.ranks | filter: {rank_type_id: contact.person.serviceHistory.rankTypeId, branch_id: contact.person.serviceHistory.branchId}">
          <option value="">Select One</option>
        </select>
      </div>
    </div>
  </div>

  <div class="row" ng-show="contact.showAwards()">
    <div class="col-xs-12">
      <h4>Service Awards</h4>
    </div>
  </div>

  <div class="row" ng-show="contact.showAwards()">
    <div class="col-xs-12">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Name</th>
            <th>Quantity</th>
            <th colspan="2">Comment/Story</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <select class="form-control"
                ng-model="contact.awardName"
                required
                ng-options="award.name for award in serviceHistory.awards | valueOrNull:'branch_id':contact.person.serviceHistory.branchId">
                <!--WORKING THIS WHEN STOPPED-->
                <option>Select One</option>
              </select>
            </td>
            <td>
              <input type="number" ng-model="contact.awardQuantity" class="form-control" style="width:75px;">
            </td>
            <td class="">
              <input type="text" ng-model="contact.awardComment" class="form-control">
            </td>
            <td>
              <button class="btn btn-primary form-control" ng-click="contact.addAward()">
                <i class="fa fa-plus"></i>
              </button>
            </td>
          </tr>
          <tr ng-repeat="award in contact.person.serviceHistory.serviceAwards ">
            <td>{{serviceHistory.awardNameFor(award.awardId)}}</td>
            <td>{{award.quantity}}</td>
            <td>{{award.comment}}</td>
            <td>
              <button class="btn btn-primary form-control" ng-click="contact.deleteAward(award, $index)">
                <i class="fa fa-trash-o"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 text-right">
      <button class="btn btn-primary" ng-click="contact.submitServiceHistory('applications.medicalConditions')">Next</button>
    </div>
  </div>
</div>
